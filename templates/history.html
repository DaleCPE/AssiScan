<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <title>Database Records | AssiScan</title>
    <link href="[https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap](https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap)" rel="stylesheet">
    <link rel="stylesheet" href="[https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css](https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css)">
    <style>
        :root { --gold: #d4af37; --bg: #0f0404; --card-bg: #1a0b0b; }
        body { background: var(--bg); color: #f0f0f0; font-family: 'Inter', sans-serif; margin: 0; padding: 20px; }
        
        /* HEADER */
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 1px solid rgba(212,175,55,0.2); padding-bottom: 15px; }
        h2 { margin: 0; color: var(--gold); font-size: 20px; }
        .btn-logout { text-decoration: none; color: #ff6b6b; font-size: 12px; border: 1px solid #ff6b6b; padding: 8px 12px; border-radius: 4px; transition: 0.3s; }
        .btn-logout:hover { background: #ff6b6b; color: #fff; }

        /* TABLE STYLES (DESKTOP) */
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #331010; font-size: 14px; }
        th { color: var(--gold); text-transform: uppercase; font-size: 11px; letter-spacing: 1px; }
        tr:hover { background: rgba(255,255,255,0.02); }
        
        .doc-link { color: #aaa; text-decoration: none; font-size: 12px; margin-right: 5px; }
        .doc-link:hover { color: var(--gold); }

        /* --- MOBILE RESPONSIVE MAGIC (CARD VIEW) --- */
        @media (max-width: 768px) {
            thead { display: none; } /* Hide Table Headers on Mobile */
            table, tbody, tr, td { display: block; width: 100%; } /* Stack everything */
            
            tr {
                margin-bottom: 15px;
                background: var(--card-bg);
                border: 1px solid rgba(212,175,55,0.2);
                border-radius: 8px;
                padding: 15px;
                box-shadow: 0 4px 10px rgba(0,0,0,0.5);
            }

            td {
                text-align: right;
                padding: 8px 0;
                border-bottom: 1px solid rgba(255,255,255,0.05);
                display: flex;
                justify-content: space-between;
                align-items: center;
            }

            td:last-child { border-bottom: none; }

            /* Add labels before data using CSS */
            td::before {
                content: attr(data-label);
                font-weight: bold;
                color: var(--gold);
                font-size: 11px;
                text-transform: uppercase;
            }
        }
    </style>
</head>
<body>

    <div class="header">
        <h2>DATABASE RECORDS</h2>
        <a href="/logout" class="btn-logout"><i class="fas fa-sign-out-alt"></i> LOGOUT</a>
    </div>

    <div id="loading" style="color:#666; text-align:center; margin-top:50px;">Fetching encrypted records...</div>

    <table id="recordsTable" style="display:none;">
        <thead>
            <tr>
                <th>Student Name</th>
                <th>Sex</th>
                <th>Birthdate</th>
                <th>Mother's Name</th>
                <th>Files</th>
            </tr>
        </thead>
        <tbody id="tableBody">
            </tbody>
    </table>

    <script>
        async function loadData() {
            try {
                const res = await fetch('/get-records');
                
                // Security Check: If not logged in, redirect to login
                if (res.status === 401) {
                    window.location.href = '/login';
                    return;
                }

                const data = await res.json();
                document.getElementById('loading').style.display = 'none';
                document.getElementById('recordsTable').style.display = 'table';
                const tbody = document.getElementById('tableBody');

                if(data.records.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="5" style="text-align:center;">No records found.</td></tr>';
                    return;
                }

                tbody.innerHTML = data.records.map(r => `
                    <tr>
                        <td data-label="Student Name" style="font-weight:bold; color:#fff;">${r.name}</td>
                        <td data-label="Sex">${r.sex}</td>
                        <td data-label="Birthdate">${r.birthdate}</td>
                        <td data-label="Mother's Name">${r.mother_name}</td>
                        <td data-label="Attachments">
                            ${r.image_path ? `<a href="/uploads/${r.image_path.split('/').pop()}" target="_blank" class="doc-link"><i class="fas fa-file-image"></i> PSA</a>` : ''}
                            ${r.form137_path ? `<a href="/uploads/${r.form137_path.split('/').pop()}" target="_blank" class="doc-link"><i class="fas fa-file-alt"></i> F137</a>` : ''}
                        </td>
                    </tr>
                `).join('');
            } catch (e) {
                console.error(e);
                document.getElementById('loading').innerText = "Access Error.";
            }
        }
        loadData();
    </script>
</body>
</html>
